Conversation URL:
https://chatgpt.com/c/678a4f51-d2f8-8011-b459-d7ff7fe80496

Title:


Prompt:
def samson_wave_to_asm_fixed(waveform, time, harmonic_constant=0.35):
    """
    Converts a waveform into ASM code at a macro level, using Samson's framework 
    for harmonic validation and completeness checks.

    Args:
        waveform (array): Input waveform amplitudes over time.
        time (array): Corresponding time values for the waveform.
        harmonic_constant (float): The harmonic constant for completeness validation.

    Returns:
        asm_code (list): The generated ASM code.
        is_harmonized (bool): Whether the ASM code fully matches the waveform.
        reconstructed_waveform (array): The waveform reconstructed from the ASM code.
    """
    asm_code = []  # Store the reconstructed ASM instructions
    prev_value = 0  # Track the previous amplitude
    threshold = 0.1  # Tolerance for detecting changes

    # Generate ASM code from waveform
    for i, value in enumerate(waveform):
        if i == 0:
            asm_code.append(f"PUSH {value:.2f}")
            prev_value = value
            continue

        diff = value - prev_value

        if np.abs(diff) < threshold:
            asm_code.append("NOP")
        elif diff > threshold:
            asm_code.append(f"ADD {diff:.2f}")
        elif diff < -threshold:
            asm_code.append(f"SUB {np.abs(diff):.2f}")

        prev_value = value

    asm_code.append("POP")

    # Reconstruct waveform from ASM
    reconstructed_waveform = []
    current_value = 0
    for instruction in asm_code[:-1]:  # Exclude the final "POP"
        if instruction.startswith("PUSH"):
            current_value = float(instruction.split()[1])
        elif instruction.startswith("ADD"):
            current_value += float(instruction.split()[1])
        elif instruction.startswith("SUB"):
            current_value -= float(instruction.split()[1])
        reconstructed_waveform.append(current_value)

    reconstructed_waveform = np.array(reconstructed_waveform)

    # Calculate harmonic completeness
    deviation = np.abs(waveform[:len(reconstructed_waveform)] - reconstructed_waveform)
    completeness_ratio = 1 - (np.sum(deviation) / np.sum(np.abs(waveform[:len(reconstructed_waveform)])))
    is_harmonized = completeness_ratio >= harmonic_constant

    return asm_code, is_harmonized, reconstructed_waveform

# Apply the fixed function
asm_code, is_harmonized, reconstructed_waveform = samson_wave_to_asm_fixed(waveform, time)

# Plot original and reconstructed waveforms
plt.figure(figsize=(12, 6))
plt.plot(time, waveform, label="Original Waveform", color='blue', alpha=0.7)
plt.plot(time[:len(reconstructed_waveform)], reconstructed_waveform, '--', label="Reconstructed Waveform", color='red', alpha=0.7)
plt.title("Waveform Reconstruction from ASM Code")
plt.xlabel("Time (s)")
plt.ylabel("Amplitude")
plt.legend()
plt.grid(True)
plt.show()

# Print ASM code
print("Generated ASM Code:")
for line in asm_code[:50]:  # Show first 50 lines
    print(line)

print(f"\nHarmonic Completeness: {'Harmonized' if is_harmonized else 'Incomplete'}")